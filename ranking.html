<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>🏆 ランキング - 2次関数トレーニング</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        body { font-family: sans-serif; max-width: 800px; margin: 20px auto; padding: 20px; background-color: #f4f4f9; }
        h1 { text-align: center; color: #333; }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); background-color: white; }
        th, td { padding: 12px 15px; border: 1px solid #ddd; text-align: center; }
        th { background-color: #007bff; color: white; }
        tr:nth-child(even) { background-color: #f2f2f2; }
        tr.top-rank-1 { background-color: #ffd700; font-weight: bold; }
        tr.top-rank-2 { background-color: #c0c0c0; }
        tr.top-rank-3 { background-color: #cd7f32; color: white;}
        #loading { text-align: center; font-size: 1.2em; padding: 50px; }
    </style>
</head>
<body>
    <h1>🏆 ランキング 🏆</h1>
    <div id="loading">ランキングデータを読み込み中...</div>
    <table id="ranking-table" style="display:none;">
        <thead>
            <tr>
                <th>順位</th>
                <th>ニックネーム</th>
                <th>スコア</th>
                <th>総タイム (秒)</th>
                <th>記録日時</th>
            </tr>
        </thead>
        <tbody id="ranking-body">
        </tbody>
    </table>
    <script>
        const GAS_URL = 'https://script.google.com/macros/s/AKfycbwXkwNnWEJ84urMGCwQgVrycf5ictFI9S0GGH29JNh4d7LuII7fzC4oNPkftqQ1hZPLIw/exec';

        window.onload = function() {
            fetch(GAS_URL)
                .then(response => response.json())
                .then(data => {
                    const tableBody = document.getElementById('ranking-body');
                    const loadingDiv = document.getElementById('loading');
                    const table = document.getElementById('ranking-table');
                    
                    if (!data || data.length === 0) {
                        loadingDiv.textContent = 'まだ記録がありません。';
                        return;
                    }

                    data.forEach((row, index) => {
                        // GASから返されるデータの列インデックス: 0:日時, 1:ニックネーム, 2:タイム, 3:スコア
                        if (!row || row.length < 4) return; 

                        const rank = index + 1;
                        const tr = document.createElement('tr');
                        
                        if (rank === 1) tr.className = 'top-rank-1';
                        if (rank === 2) tr.className = 'top-rank-2';
                        if (rank === 3) tr.className = 'top-rank-3';

                        tr.innerHTML = `
                            <td>${rank}</td>
                            <td>${row[1]}</td>
                            <td>${row[3]} 点</td>
                            <td>${parseFloat(row[2]).toFixed(2)}</td>
                            <td>${new Date(row[0]).toLocaleString('ja-JP')}</td>
                        `;
                        tableBody.appendChild(tr);
                    });

                    loadingDiv.style.display = 'none';
                    table.style.display = 'table';
                })
                .catch(error => {
                    console.error('ランキングデータの取得に失敗:', error);
                    document.getElementById('loading').textContent = 'エラー: ランキングデータを取得できませんでした。';
                });
        };
    </script>
</body>
</html>